# Fixes — 2025-12-18

## Task 1 — Signup failed (SettingsThrottle signature mismatch)

**What changed**
- Updated `App\Http\Middleware\SettingsThrottle` so its `handle()` method matches Laravel’s `ThrottleRequests` signature.
- Preserved “profile” usage (e.g. `settings.throttle:tight`, `settings.throttle:relaxed`, `settings.throttle:auth_login`) by interpreting a non-numeric first argument as the profile name.
- When using a profile, the middleware reads limits from Settings keys and forwards computed values to `ThrottleRequests` with a profile-specific prefix to prevent collisions.

**Files touched**
- `app/Http/Middleware/SettingsThrottle.php`
- `tests/Feature/RegistrationThrottleApiTest.php`

**How to verify**
- Run tests: `php artisan test --filter=RegistrationThrottleApiTest`
- Or manually: `POST /api/register` should return `201` (or validation errors), and never `500`.

## Task 2 — Add “Pest Control” services

**What changed**
- Added an idempotent seeder that ensures a `Pest Control` category exists, with common pest-control subcategories and matching active services.
- Wired the seeder into the standard `DatabaseSeeder`.

**Files touched**
- `database/seeders/PestControlSeeder.php`
- `database/seeders/DatabaseSeeder.php`

**How to verify**
- Run: `php artisan db:seed --class=PestControlSeeder`
- Confirm via API:
  - `GET /api/categories` includes `Pest Control`
  - `GET /api/categories/{id}/subcategories` shows the added subcategories

